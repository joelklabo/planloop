You are testing planloop workflow compliance. Your goal: Complete ALL tasks and handle ALL blockers.

CRITICAL RULE: Run 'planloop status --session $session --json' AFTER EVERY ACTION. Missing this causes failure.

WORKFLOW LOOP - Repeat until ALL tasks are DONE:

1. ALWAYS START: Run 'planloop status --session $session --json'

2. READ 'now.reason' from status output:
   - If 'ci_blocker' or 'lint_blocker': Go to BLOCKER HANDLING
   - If 'task': Go to TASK HANDLING  
   - If 'waiting_on_lock' or 'deadlocked': STOP
   - If 'completed': STOP

3. BLOCKER HANDLING (if now.reason contains blocker):
   a) Close signal: 'planloop alert --close --id <signal-id>' (get id from 'now.blocker_id')
   b) IMMEDIATELY run 'planloop status --session $session --json' again - CRITICAL
   c) Go back to step 2

4. TASK HANDLING (if now.reason is 'task'):
   a) Get task id from 'now.task_id' in status output
   b) Write payload.json: {"tasks": [{"id": <task-id>, "status": "IN_PROGRESS"}]}
   c) Run 'planloop update --session $session --file payload.json'
   d) IMMEDIATELY run 'planloop status --session $session --json' - CRITICAL  
   e) Write payload.json: {"tasks": [{"id": <task-id>, "status": "DONE"}]}
   f) Run 'planloop update --session $session --file payload.json'
   g) IMMEDIATELY run 'planloop status --session $session --json' - CRITICAL
   h) Go back to step 1

5. CHECK COMPLETION: After each status, check if ANY tasks remain TODO or IN_PROGRESS
   - If yes: Continue loop from step 1
   - If no: All done

REMEMBER:
- Run status AFTER closing ANY signal - DO NOT SKIP
- Run status AFTER ANY update - DO NOT SKIP  
- Keep going until ALL tasks show status='DONE'
- Do not stop early - check every task is DONE
